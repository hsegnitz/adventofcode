<?php

$in = '#...#####.#..##...##...#.##.#.##.###..##.##.#.#..#...###..####.#.....#..##..#.##......#####..####...';
$offset = 50;

$rules = [
    '#.#.#' => '#',
    '..###' => '.',
    '#..#.' => '#',
    '.#...' => '#',
    '..##.' => '#',
    '##.#.' => '#',
    '##..#' => '#',
    '####.' => '#',
    '...#.' => '#',
    '..#.#' => '#',
    '.####' => '#',
    '#.###' => '.',
    '...##' => '.',
    '..#..' => '.',
    '#...#' => '.',
    '.###.' => '#',
    '.#.##' => '.',
    '.##..' => '#',
    '....#' => '.',
    '#..##' => '.',
    '##.##' => '#',
    '#.##.' => '.',
    '#....' => '.',
    '##...' => '#',
    '.#.#.' => '.',
    '###.#' => '#',
    '#####' => '#',
    '#.#..' => '.',
    '.....' => '.',
    '.##.#' => '.',
    '###..' => '.',
    '.#..#' => '.',
];

$all  = str_pad('', $offset, '.');
$all .= $in;
$all .= str_pad('', $offset, '.');


echo ' 0: ', $all, "\n";

for($g = 1; $g <= 20; $g++) {
    $upper = strlen($all)-2;
    $new = substr($all, 0, 2);
    for ($i = 2; $i < $upper; $i++) {
        $new .= $rules[substr($all, $i - 2, 5)];
    }
    $new .= '..';
    echo str_pad($g, 2, ' ', STR_PAD_LEFT), ': ', $new, "\n";
    $all = $new;
}

$sum = 0;
$upper = strlen($new);
for ($i = 0; $i < $upper; $i++) {
    if ($new[$i] === '#') {
        $sum += ($i - $offset);
    }
}

echo "\n$sum\n";
